
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.greenmask.io/dev/database_subset/">
      
      
        <link rel="prev" href="../commands/delete/">
      
      
        <link rel="next" href="../built_in_transformers/">
      
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>Database subset - Greenmask — PostgreSQL database anonymization and synthetic data generation tool</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-1LGGK7P1GD"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-1LGGK7P1GD",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-1LGGK7P1GD",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Database subset - Greenmask — PostgreSQL database anonymization and synthetic data generation tool" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://docs.greenmask.io/dev/assets/images/social/database_subset.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://docs.greenmask.io/dev/database_subset/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Database subset - Greenmask — PostgreSQL database anonymization and synthetic data generation tool" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://docs.greenmask.io/dev/assets/images/social/database_subset.png" >
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#database-subset" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
  A new version 0.2.6 (2024.12.07) is <a href="https://github.com/GreenmaskIO/greenmask/releases/tag/v0.2.6">released</a>

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../.."> 
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Greenmask — PostgreSQL database anonymization and synthetic data generation tool" class="md-header__button md-logo" aria-label="Greenmask — PostgreSQL database anonymization and synthetic data generation tool" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Greenmask — PostgreSQL database anonymization and synthetic data generation tool
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Database subset
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/GreenmaskIO/greenmask" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GreenmaskIO/greenmask
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../architecture/" class="md-tabs__link">
          
  
    
  
  Documentation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../release_notes/greenmask_0_2_6/" class="md-tabs__link">
          
  
    
  
  Release notes

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Greenmask — PostgreSQL database anonymization and synthetic data generation tool" class="md-nav__button md-logo" aria-label="Greenmask — PostgreSQL database anonymization and synthetic data generation tool" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    Greenmask — PostgreSQL database anonymization and synthetic data generation tool
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/GreenmaskIO/greenmask" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GreenmaskIO/greenmask
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href=".." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../playground/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Playground
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../commands/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Commands
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            Commands
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/list-transformers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    list-transformers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/show-transformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    show-transformer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    validate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/dump/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dump
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/list-dumps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    list-dumps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/show-dump/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    show-dump
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/restore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    restore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/delete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    delete
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Database subset
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Database subset
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#detail" class="md-nav__link">
    <span class="md-ellipsis">
      Detail
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use cases
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-with-null-values" class="md-nav__link">
    <span class="md-ellipsis">
      References with NULL values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circular-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Circular reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-references" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual references
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#polymorphic-references" class="md-nav__link">
    <span class="md-ellipsis">
      Polymorphic references
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exclude-the-records-that-has-null-values-in-the-referenced-column" class="md-nav__link">
    <span class="md-ellipsis">
      Exclude the records that has NULL values in the referenced column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-table-is-not-filtered-by-the-subset-condition" class="md-nav__link">
    <span class="md-ellipsis">
      Some table is not filtered by the subset condition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-column-reference-id-is-ambiguous" class="md-nav__link">
    <span class="md-ellipsis">
      ERROR: column reference "id" is ambiguous
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-subset-condition-is-not-working-correctly-how-can-i-verify-it" class="md-nav__link">
    <span class="md-ellipsis">
      The subset condition is not working correctly. How can I verify it?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dump-is-too-slow" class="md-nav__link">
    <span class="md-ellipsis">
      Dump is too slow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dump-a-subset-of-the-database" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Dump a subset of the database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dump-a-subset-with-circular-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Dump a subset with circular reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dump-a-subset-with-virtual-references" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Dump a subset with virtual references
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dump-a-subset-with-polymorphic-references" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Dump a subset with polymorphic references
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../built_in_transformers/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Transformers
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_7" id="__nav_1_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            Transformers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/dynamic_parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/transformation_engines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformation engines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/parameters_templating/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parameters templating
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/transformation_condition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformation conditions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/transformation_inheritance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformation inheritance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../built_in_transformers/standard_transformers/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Standard transformers
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_7_7" id="__nav_1_7_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7_7">
            <span class="md-nav__icon md-icon"></span>
            Standard transformers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/cmd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cmd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/dict/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dict
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/masking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Masking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/noise_date/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NoiseDate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/noise_float/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NoiseFloat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/noise_numeric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NoiseNumeric
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/noise_int/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NoiseInt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_bool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomBool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_choice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomChoice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_date/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomDate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_float/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomFloat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_numeric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomNumeric
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_int/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomInt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomString
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_uuid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomUuid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_latitude/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomLatitude
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_longitude/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomLongitude
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_unix_timestamp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomUnixTimestamp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_day_of_week/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomDayOfWeek
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_day_of_month/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomDayOfMonth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_month_name/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomMonthName
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_year_string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomYearString
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_century/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomCentury
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_timezone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomTimezone
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_email/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomEmail
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_username/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomUsername
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_password/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomPassword
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_domain_name/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomDomainName
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_person/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomPerson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_url/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomURL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_mac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomMac
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_ip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomIP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_word/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomWord
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_sentence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomSentence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_paragraph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomParagraph
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_cc_type/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomCCType
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_cc_number/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomCCNumber
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_currency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomCurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_amount_with_currency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomAmountWithCurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_phone_number/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomPhoneNumber
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_toll_free_phone_number/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomTollFreePhoneNumber
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/random_e164_phone_number/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandomE164PhoneNumber
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/real_address/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RealAddress
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/regexp_replace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RegexpReplace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/replace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Replace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/standard_transformers/set_null/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SetNull
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../built_in_transformers/advanced_transformers/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Advanced transformers
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_7_8" id="__nav_1_7_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7_8">
            <span class="md-nav__icon md-icon"></span>
            Advanced transformers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/advanced_transformers/json/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Json
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/advanced_transformers/template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Template
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/advanced_transformers/template_record/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TemplateRecord
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7_8_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../built_in_transformers/advanced_transformers/custom_functions/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Custom functions
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_7_8_5" id="__nav_1_7_8_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_1_7_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7_8_5">
            <span class="md-nav__icon md-icon"></span>
            Custom functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/advanced_transformers/custom_functions/core_functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core custom functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../built_in_transformers/advanced_transformers/custom_functions/faker_function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Faker function
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Release notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Release notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_2_6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.2.6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_2_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.2.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_2_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.2.4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_2_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.2.3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_2_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.2.2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_2_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.2.1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_2_0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.2.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_2_0_b2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.2.0b2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_2_0_b1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.2.0b1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.14
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.13
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.12
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.11
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.10
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.9
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release_notes/greenmask_0_1_0_beta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greenmask 0.1.0 Beta
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#detail" class="md-nav__link">
    <span class="md-ellipsis">
      Detail
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use cases
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-with-null-values" class="md-nav__link">
    <span class="md-ellipsis">
      References with NULL values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circular-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Circular reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-references" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual references
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#polymorphic-references" class="md-nav__link">
    <span class="md-ellipsis">
      Polymorphic references
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exclude-the-records-that-has-null-values-in-the-referenced-column" class="md-nav__link">
    <span class="md-ellipsis">
      Exclude the records that has NULL values in the referenced column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-table-is-not-filtered-by-the-subset-condition" class="md-nav__link">
    <span class="md-ellipsis">
      Some table is not filtered by the subset condition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-column-reference-id-is-ambiguous" class="md-nav__link">
    <span class="md-ellipsis">
      ERROR: column reference "id" is ambiguous
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-subset-condition-is-not-working-correctly-how-can-i-verify-it" class="md-nav__link">
    <span class="md-ellipsis">
      The subset condition is not working correctly. How can I verify it?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dump-is-too-slow" class="md-nav__link">
    <span class="md-ellipsis">
      Dump is too slow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dump-a-subset-of-the-database" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Dump a subset of the database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dump-a-subset-with-circular-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Dump a subset with circular reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dump-a-subset-with-virtual-references" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Dump a subset with virtual references
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dump-a-subset-with-polymorphic-references" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Dump a subset with polymorphic references
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="database-subset">Database subset<a class="headerlink" href="#database-subset" title="Permanent link">&para;</a></h1>
<p>Greenmask allows you to define a subset condition for filtering data during the dump process. This feature is useful
when you need to dump only a part of the database, such as a specific table or a set of tables. It automatically
ensures data consistency by including all related data from other tables that are required to maintain the integrity of
the subset. The subset condition can be defined using <code>subset_conds</code> attribute that can be defined on the table in the
<code>transformation</code> section (see examples).</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Greenmask genrates queries for subset conditions based on the introspected schema using joins and recursive queries.
It cannot be responsible for query optimization. The subset quries might be slow due to the complexity of
the queries and/or lack of indexes. Circular are resolved using recursive queries.</p>
</div>
<h2 id="detail">Detail<a class="headerlink" href="#detail" title="Permanent link">&para;</a></h2>
<p>The subset is a list of SQL conditions that are applied to table. The conditions are combined with <code>AND</code> operator. <strong>You
need</strong> to specify the <strong>schema</strong>, <strong>table</strong> and <strong>column</strong> name when pointing out the column to filter by to avoid
ambiguity. The subset condition must be a valid SQL condition.</p>
<div class="highlight"><span class="filename">Subset condition example</span><pre><span></span><code><span class="nt">subset_conds</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;person.businessentity.businessentityid</span><span class="nv"> </span><span class="s">IN</span><span class="nv"> </span><span class="s">(274,</span><span class="nv"> </span><span class="s">290,</span><span class="nv"> </span><span class="s">721,</span><span class="nv"> </span><span class="s">852)&#39;</span>
</code></pre></div>
<h2 id="use-cases">Use cases<a class="headerlink" href="#use-cases" title="Permanent link">&para;</a></h2>
<ul>
<li>Database scale down - create anonymized dump but for the limited and consistent set of tables</li>
<li>Data migration - migrate only some records from one database to another</li>
<li>Data anonymization - dump and anonymize only a specific records in the database</li>
<li>Database catchup - catchup your another instance of database logically by adding a new records. In this case it
  is recommended to <a href="../commands/restore/#restoration-in-topological-order">restore tables in topological order</a> using
  <code>--restore-in-order</code>.</li>
</ul>
<h2 id="references-with-null-values">References with NULL values<a class="headerlink" href="#references-with-null-values" title="Permanent link">&para;</a></h2>
<p>For references that <strong>do not have</strong> <code>NOT NULL</code> constraints, Greenmask will automatically generate <code>LEFT JOIN</code> queries
with the appropriate conditions to ensure integrity checks. You can rely on Greenmask to handle such cases correctly—no
special configuration is needed, as it performs this automatically based on the introspected schema.</p>
<h2 id="circular-reference">Circular reference<a class="headerlink" href="#circular-reference" title="Permanent link">&para;</a></h2>
<p>Greenmask <strong>supports circular</strong> references between tables. You can define a subset condition for any table, and
Greenmask will automatically generate the appropriate queries for the table subset using recursive queries. The subset
system ensures data consistency by validating all records found through the recursive queries. If a record does not meet
the subset condition, it will be excluded along with its parent records, preventing constraint violations.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently (v0.2b2), Greenmask can resolve multi-cylces in one strogly connected component, but only for one group 
of vertexes. If you have SSC that contains 2 groups of vertexes, Greenmask will not be able to 
resolve it. For instance we have 2 cycles with tables <code>A, B, C</code> (first group) and <code>B, C, E</code> (second group). 
Greenmask will not be able to resolve it. But if you have only one group of vertexes one and more cycles in the 
same group of tables (for instance <code>A, B, C</code>), Greenmask works with it. This will be fixed in the future.
See second example below. In practice this is quite rare situation and 99% of people will not face this issue. </p>
</div>
<p>You can read the Wikipedia article about Circular reference <a href="https://en.wikipedia.org/wiki/Circular_reference">here</a>.</p>
<h2 id="virtual-references">Virtual references<a class="headerlink" href="#virtual-references" title="Permanent link">&para;</a></h2>
<p>During the development process, there are <strong>situations where foreign keys need to be removed</strong>. The reasons can
vary—from improving performance to simplifying the database structure. Additionally, some foreign keys may exist within
loosely structured data, such as JSON, where PostgreSQL cannot create foreign keys at all. These limitations could
significantly hinder the capabilities of a subset system. Greenmask offers a flexible solution to this problem by
allowing the declaration of virtual references in the configuration, enabling the preservation and management of logical
relationships between tables, even in the absence of explicit foreign keys. Virtual reference can be called virtual
foreign key as well.</p>
<p>The <code>virtual_references</code> can be defined in <code>dump</code> section. It contains the list of virtual references. First you set
the table where you want to define virtual reference. In the attribute <code>references</code> define the list of tables that are
referenced by the table. In the <code>columns</code> attribute define the list of columns that are used in the foreign key
reference. The <code>not_null</code> attribute is optional and defines if the FK has not null constraint. If <code>true</code> Greenmask will
generate <code>INNER JOIN</code> instead of <code>LEFT JOIN</code> by default it is <code>false</code>. The <code>expression</code> needs to be used when you
want to use some expression to get the value of the column in the referencing table. For instance, if you have JSONB
column in the <code>audit_logs</code> table that contains <code>order_id</code> field, you can use this field as FK reference.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>You do not need to define primry key of the referenced table. Greenmask will automatically resolve it and use it in
the join condition.</p>
</div>
<div class="highlight"><span class="filename">Virtual references example</span><pre><span></span><code><span class="nt">dump</span><span class="p">:</span>
<span class="w">  </span><span class="nt">virtual_references</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="w"> </span><span class="c1"># (1)</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;orders&quot;</span><span class="w"> </span><span class="c1"># (2)</span>
<span class="w">      </span><span class="nt">references</span><span class="p">:</span><span class="w"> </span><span class="c1"># (3)</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="w"> </span><span class="c1"># (4) </span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customers&quot;</span><span class="w"> </span><span class="c1"># (5)</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span><span class="w"> </span><span class="c1"># (6)</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customer_id&quot;</span>
<span class="w">          </span><span class="nt">not_null</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># (7)</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;audit_logs&quot;</span>
<span class="w">      </span><span class="nt">references</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;orders&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(public.audit_logs.log_data</span><span class="nv"> </span><span class="s">-&gt;&gt;</span><span class="nv"> </span><span class="s">&#39;order_id&#39;)::INT&quot;</span><span class="w"> </span><span class="c1"># (8)</span>
</code></pre></div>
<ol>
<li>The schema name of table that has foreign key reference (table that own FK reference)</li>
<li>The table name that has foreign key reference (table that own FK reference)</li>
<li>List of virtual references</li>
<li>The schema name of the table that has foreign key reference (referencing table)</li>
<li>The table name that has foreign key reference (referencing table)</li>
<li>
<p>List of columns that are used in the foreign key reference. Each column has one of property defined at the same time:</p>
<ul>
<li><code>name</code> - column name in the referencing table</li>
<li><code>expression</code> - expression that is used to get the value of the column in the referencing table</li>
</ul>
</li>
<li>
<p><code>not_null</code> - is FK has not null constraint. If <code>true</code> Default it is <code>false</code></p>
</li>
<li><code>expression</code> - expression that is used to get the value of the column in the referencing table</li>
</ol>
<h2 id="polymorphic-references">Polymorphic references<a class="headerlink" href="#polymorphic-references" title="Permanent link">&para;</a></h2>
<p>Greenmask supports polymorphic references. You can define a virtual reference for a table with polymorphic references
using <code>polymorphic_exprs</code> attribute. The <code>polymorphic_exprs</code> attribute is a list of expressions that are used to make
a polymorphic reference. For instance we might have a table <code>comments</code> that has polymorphic reference to <code>posts</code> and
<code>videos</code>. The table comments might have <code>commentable_id</code> and <code>commentable_type</code> columns. The <code>commentable_type</code> column
contains the type of the table that is referenced by the <code>commentable_id</code> column. The example of the config:</p>
<div class="highlight"><span class="filename">Polymorphic references example</span><pre><span></span><code><span class="nt">dump</span><span class="p">:</span>
<span class="w">  </span><span class="nt">virtual_references</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;comments&quot;</span>
<span class="w">      </span><span class="nt">references</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;videos&quot;</span>
<span class="w">          </span><span class="nt">polymorphic_exprs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;public.comments.commentable_type</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">&#39;video&#39;&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;commentable_id&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;posts&quot;</span>
<span class="w">          </span><span class="nt">polymorphic_exprs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;public.comments.commentable_type</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">&#39;post&#39;&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;commentable_id&quot;</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The plimorphic references cannot be non_null because the <code>commentable_id</code> column can be <code>NULL</code> if the 
<code>commentable_type</code> is not set or different that the values defined in the <code>polymorphic_exprs</code> attribute.</p>
</div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="exclude-the-records-that-has-null-values-in-the-referenced-column">Exclude the records that has NULL values in the referenced column<a class="headerlink" href="#exclude-the-records-that-has-null-values-in-the-referenced-column" title="Permanent link">&para;</a></h3>
<p>If you want to exclude records that have NULL values in the referenced column, you can manually add this condition to
the subset condition for the table. Greenmask does not automatically exclude records with NULL values because it applies
a <code>LEFT OUTER JOIN</code> on nullable foreign keys.</p>
<h3 id="some-table-is-not-filtered-by-the-subset-condition">Some table is not filtered by the subset condition<a class="headerlink" href="#some-table-is-not-filtered-by-the-subset-condition" title="Permanent link">&para;</a></h3>
<p>Greenmask builds a table dependency graph based on the introspected schema and existing foreign keys. If a table is not
filtered by the subset condition, it means that the table either does not reference another table that is filtered by
the subset condition or the table itself does not have a subset condition applied.</p>
<p>If you have a table with a removed foreign key and want to filter it by the subset condition, you need to define a
virtual reference. For more information on virtual references, refer to the <a href="#virtual-references">Virtual References</a>
section.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If you find any issues related to the code or greenmask is not working as expected, do not hesitate to contact us 
 <a href="../#links">directly</a> or by creating an <a href="https://github.com/GreenmaskIO/greenmask/issues">issue in the repository</a>.</p>
</div>
<h3 id="error-column-reference-id-is-ambiguous">ERROR: column reference "id" is ambiguous<a class="headerlink" href="#error-column-reference-id-is-ambiguous" title="Permanent link">&para;</a></h3>
<p>If you see the error message <code>ERROR: column reference "{column name}" is ambiguous</code>, you have specified the column name
without the table and/or schema name. To avoid ambiguity, always specify the schema and table name when pointing out the
column to filter by. For instance if you want to filter employees by <code>employee_id</code> column, you should
use <code>public.employees.employee_id</code> instead of <code>employee_id</code>.</p>
<div class="highlight"><span class="filename">Valid subset condition</span><pre><span></span><code><span class="n">public</span><span class="mf">.</span><span class="n">employees</span><span class="mf">.</span><span class="n">employee_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span>
</code></pre></div>
<h3 id="the-subset-condition-is-not-working-correctly-how-can-i-verify-it">The subset condition is not working correctly. How can I verify it?<a class="headerlink" href="#the-subset-condition-is-not-working-correctly-how-can-i-verify-it" title="Permanent link">&para;</a></h3>
<p>Run greenmask with <code>--log-level=debug</code> to see the generated SQL queries. You will find the generated SQL queries in the
log output. Validate this query in your database client to ensure that the subset condition is working as expected.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>greenmask<span class="w"> </span>dump<span class="w"> </span>--config<span class="w"> </span>config.yaml<span class="w"> </span>--log-level<span class="o">=</span>debug

<span class="m">2024</span>-08-29T19:06:18+03:00<span class="w"> </span>DBG<span class="w"> </span>internal/db/postgres/context/context.go:202<span class="w"> </span>&gt;<span class="w"> </span>Debug<span class="w"> </span>query<span class="w"> </span><span class="nv">Schema</span><span class="o">=</span>person<span class="w"> </span><span class="nv">Table</span><span class="o">=</span>businessentitycontact<span class="w"> </span><span class="nv">pid</span><span class="o">=</span><span class="m">1638339</span>
<span class="m">2024</span>-08-29T19:06:18+03:00<span class="w"> </span>DBG<span class="w"> </span>internal/db/postgres/context/context.go:203<span class="w"> </span>&gt;<span class="w"> </span>SELECT<span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentitycontact&quot;</span>.*<span class="w"> </span>FROM<span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentitycontact&quot;</span><span class="w">  </span>INNER<span class="w"> </span>JOIN<span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentity&quot;</span><span class="w"> </span>ON<span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentitycontact&quot;</span>.<span class="s2">&quot;businessentityid&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentity&quot;</span>.<span class="s2">&quot;businessentityid&quot;</span><span class="w"> </span>AND<span class="w"> </span><span class="o">(</span><span class="w"> </span>person.businessentity.businessentityid<span class="w"> </span>between<span class="w"> </span><span class="m">400</span><span class="w"> </span>and<span class="w"> </span><span class="m">800</span><span class="w"> </span>OR<span class="w"> </span>person.businessentity.businessentityid<span class="w"> </span>between<span class="w"> </span><span class="m">800</span><span class="w"> </span>and<span class="w"> </span><span class="m">900</span><span class="w"> </span><span class="o">)</span><span class="w"> </span>INNER<span class="w"> </span>JOIN<span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;person&quot;</span><span class="w"> </span>ON<span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentitycontact&quot;</span>.<span class="s2">&quot;personid&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentityid&quot;</span><span class="w"> </span>WHERE<span class="w"> </span>TRUE<span class="w"> </span>AND<span class="w"> </span><span class="o">((</span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentityid&quot;</span><span class="o">)</span><span class="w"> </span>IN<span class="w"> </span><span class="o">(</span>SELECT<span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentity&quot;</span>.<span class="s2">&quot;businessentityid&quot;</span><span class="w"> </span>FROM<span class="w"> </span><span class="s2">&quot;person&quot;</span>.<span class="s2">&quot;businessentity&quot;</span><span class="w">   </span>WHERE<span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="o">(</span><span class="w"> </span>person.businessentity.businessentityid<span class="w"> </span>between<span class="w"> </span><span class="m">400</span><span class="w"> </span>and<span class="w"> </span><span class="m">800</span><span class="w"> </span>OR<span class="w"> </span>person.businessentity.businessentityid<span class="w"> </span>between<span class="w"> </span><span class="m">800</span><span class="w"> </span>and<span class="w"> </span><span class="m">900</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="o">)))</span>
<span class="w"> </span><span class="nv">pid</span><span class="o">=</span><span class="m">1638339</span>
</code></pre></div>
<h3 id="dump-is-too-slow">Dump is too slow<a class="headerlink" href="#dump-is-too-slow" title="Permanent link">&para;</a></h3>
<p>If the dump process is too slow the generated query might be too complex. In this case you can:</p>
<ul>
<li>Check if the database has indexes on the columns used in the subset condition. Create them if possible.</li>
<li>Move database dumping on the replica to avoid the performance impact on the primary.</li>
</ul>
<h2 id="example-dump-a-subset-of-the-database">Example: Dump a subset of the database<a class="headerlink" href="#example-dump-a-subset-of-the-database" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>All examples based on playground database. Read more about the playground database in the 
<a href="../playground/">Playground</a> section.</p>
</div>
<p>The following example demonstrates how to dump a subset of the <code>person</code> schema. The subset condition is applied to the
<code>businessentity</code> and <code>password</code> tables. The subset condition filters the data based on the <code>businessentityid</code> and
<code>passwordsalt</code> columns, respectively.</p>
<div class="highlight"><span class="filename">Subset configuration example</span><pre><span></span><code><span class="nt">transformation</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;person&quot;</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;businessentity&quot;</span>
<span class="w">    </span><span class="nt">subset_conds</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;person.businessentity.businessentityid</span><span class="nv"> </span><span class="s">IN</span><span class="nv"> </span><span class="s">(274,</span><span class="nv"> </span><span class="s">290,</span><span class="nv"> </span><span class="s">721,</span><span class="nv"> </span><span class="s">852)&#39;</span>
<span class="w">    </span><span class="nt">transformers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RandomDate&quot;</span>
<span class="w">        </span><span class="nt">params</span><span class="p">:</span>
<span class="w">          </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;modifieddate&quot;</span>
<span class="w">          </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2020-01-01</span><span class="nv"> </span><span class="s">00:00:00&quot;</span>
<span class="w">          </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2024-06-26</span><span class="nv"> </span><span class="s">00:00:00&quot;</span>
<span class="w">          </span><span class="nt">truncate</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;day&quot;</span>
<span class="w">          </span><span class="nt">keep_null</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;person&quot;</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;password&quot;</span>
<span class="w">    </span><span class="nt">subset_conds</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">        </span><span class="no">person.password.passwordsalt = &#39;329eacbe-c883-4f48-b8b6-17aa4627efff&#39;</span>
</code></pre></div>
<h2 id="example-dump-a-subset-with-circular-reference">Example: Dump a subset with circular reference<a class="headerlink" href="#example-dump-a-subset-with-circular-reference" title="Permanent link">&para;</a></h2>
<div class="highlight"><span class="filename">Create tables with multi cyles</span><pre><span></span><code><span class="c1">-- Step 1: Create tables without foreign keys</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">employee_id</span><span class="w">   </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="k">name</span><span class="w">          </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">department_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="c1">-- Will reference departments(department_id)</span>
<span class="p">);</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">departments</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">departments</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">department_id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="k">name</span><span class="w">          </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">project_id</span><span class="w">    </span><span class="nb">INT</span><span class="w"> </span><span class="c1">-- Will reference projects(project_id)</span>
<span class="p">);</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">projects</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">projects</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">project_id</span><span class="w">       </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="k">name</span><span class="w">             </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">lead_employee_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="c1">-- Will reference employees(employee_id)</span>
<span class="w">    </span><span class="n">head_employee_id</span><span class="w"> </span><span class="nb">INT</span><span class="w">  </span><span class="c1">-- Will reference employees(employee_id)</span>
<span class="p">);</span>

<span class="c1">-- Step 2: Alter tables to add foreign key constraints</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span>
<span class="w">    </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_department</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">department_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">departments</span><span class="w"> </span><span class="p">(</span><span class="n">department_id</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">departments</span>
<span class="w">    </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_project</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">project_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">projects</span><span class="w"> </span><span class="p">(</span><span class="n">project_id</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">projects</span>
<span class="w">    </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_lead_employee</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">lead_employee_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span><span class="n">employee_id</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">projects</span>
<span class="w">    </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_lead_employee2</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">head_employee_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span><span class="n">employee_id</span><span class="p">);</span>

<span class="c1">-- Insert projects</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">projects</span><span class="w"> </span><span class="p">(</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">lead_employee_id</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Project &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">generate_series</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

<span class="c1">-- Insert departments</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">departments</span><span class="w"> </span><span class="p">(</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">project_id</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Department &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">generate_series</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

<span class="c1">-- Insert employees and assign 10 of them as project leads</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">department_id</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Employee &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">generate_series</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">99</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

<span class="c1">-- Assign 10 employees as project leads</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">projects</span>
<span class="k">SET</span><span class="w"> </span><span class="n">lead_employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span>
<span class="w">                        </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span>
<span class="w">                        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">employees</span><span class="mf">.</span><span class="n">department_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projects</span><span class="mf">.</span><span class="n">project_id</span>
<span class="w">                        </span><span class="k">LIMIT</span><span class="w"> </span><span class="mf">1</span><span class="p">),</span>
<span class="w">    </span><span class="n">head_employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">project_id</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span>
</code></pre></div>
<p>This schema has two cycles:</p>
<ul>
<li><code>employees (department_id) -&gt; departments (project_id) -&gt; projects (lead_employee_id) -&gt; employees (employee_id)</code></li>
<li><code>employees (department_id) -&gt; departments (project_id) -&gt; projects (head_employee_id) -&gt; employees (employee_id)</code></li>
</ul>
<p>Greenmask can simply resolve it by generating a recursive query with integrity checks for subset and join conditions.</p>
<p>The example below will fetch the data for both 3 employees and related departments and projects.</p>
<div class="highlight"><span class="filename">Subset configuration example</span><pre><span></span><code><span class="nt">transformation</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;employees&quot;</span>
<span class="w">    </span><span class="nt">subset_conds</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;public.employees.employee_id</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">(1,</span><span class="nv"> </span><span class="s">2,</span><span class="nv"> </span><span class="s">3)&quot;</span>
</code></pre></div>
<p>But this will return empty result, because the subset condition is not met for all related tables because project with
<code>project_id=1</code> has reference to employee with <code>employee_id=3</code> that is invalid for subset condition.</p>
<div class="highlight"><span class="filename">Subset configuration example</span><pre><span></span><code><span class="nt">transformation</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;employees&quot;</span>
<span class="w">    </span><span class="nt">subset_conds</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;public.employees.employee_id</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">(1,</span><span class="nv"> </span><span class="s">2)&quot;</span>
</code></pre></div>
<h2 id="example-dump-a-subset-with-virtual-references">Example: Dump a subset with virtual references<a class="headerlink" href="#example-dump-a-subset-with-virtual-references" title="Permanent link">&para;</a></h2>
<p>In this example, we will create a subset of the tables with virtual references. The subset will include the
<code>orders</code> table and its related tables <code>customers</code> and <code>audit_logs</code>. The <code>orders</code> table has a virtual reference to the
<code>customers</code> table, and the <code>audit_logs</code> table has a virtual reference to the <code>orders</code> table.</p>
<div class="highlight"><span class="filename">Create tables with virtual references</span><pre><span></span><code><span class="c1">-- Create customers table</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">customers</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">customer_id</span><span class="w">   </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">customer_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">100</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- Create orders table</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">order_id</span><span class="w">    </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="c1">-- This should reference customers.customer_id, but no FK constraint is defined</span>
<span class="w">    </span><span class="n">order_date</span><span class="w">  </span><span class="nb">DATE</span>
<span class="p">);</span>

<span class="c1">-- Create payments table</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">payments</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">payment_id</span><span class="w">     </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">order_id</span><span class="w">       </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="c1">-- This should reference orders.order_id, but no FK constraint is defined</span>
<span class="w">    </span><span class="n">payment_amount</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
<span class="w">    </span><span class="n">payment_date</span><span class="w">   </span><span class="nb">DATE</span>
<span class="p">);</span>

<span class="c1">-- Insert test data into customers table</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="p">(</span><span class="n">customer_name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="s1">&#39;Jane Smith&#39;</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="s1">&#39;Alice Johnson&#39;</span><span class="p">);</span>

<span class="c1">-- Insert test data into orders table</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">order_date</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-08-01&#39;</span><span class="p">),</span><span class="w"> </span><span class="c1">-- Related to customer John Doe</span>
<span class="w">       </span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-08-05&#39;</span><span class="p">),</span><span class="w"> </span><span class="c1">-- Related to customer Jane Smith</span>
<span class="w">       </span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-08-07&#39;</span><span class="p">);</span>
<span class="c1">-- Related to customer Alice Johnson</span>

<span class="c1">-- Insert test data into payments table</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">payments</span><span class="w"> </span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">payment_amount</span><span class="p">,</span><span class="w"> </span><span class="n">payment_date</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-08-02&#39;</span><span class="p">),</span><span class="w"> </span><span class="c1">-- Related to order 1 (John Doe&#39;s order)</span>
<span class="w">       </span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">200.50</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-08-06&#39;</span><span class="p">),</span><span class="w"> </span><span class="c1">-- Related to order 2 (Jane Smith&#39;s order)</span>
<span class="w">       </span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">300.75</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-08-08&#39;</span><span class="p">);</span>
<span class="c1">-- Related to order 3 (Alice Johnson&#39;s order)</span>


<span class="c1">-- Create a table with a multi-key reference (composite key reference)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">order_items</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">order_id</span><span class="w">     </span><span class="nb">INT</span><span class="p">,</span><span class="w">               </span><span class="c1">-- Should logically reference orders.order_id</span>
<span class="w">    </span><span class="n">item_id</span><span class="w">      </span><span class="nb">INT</span><span class="p">,</span><span class="w">               </span><span class="c1">-- Composite part of the key</span>
<span class="w">    </span><span class="n">product_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">quantity</span><span class="w">     </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">item_id</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Composite primary key</span>
<span class="p">);</span>

<span class="c1">-- Create a table with a JSONB column that contains a reference value</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">audit_logs</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">log_id</span><span class="w">   </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">log_data</span><span class="w"> </span><span class="nb">JSONB</span><span class="w"> </span><span class="c1">-- This JSONB field will contain references to other tables</span>
<span class="p">);</span>

<span class="c1">-- Insert data into order_items table with multi-key reference</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">order_items</span><span class="w"> </span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">item_id</span><span class="p">,</span><span class="w"> </span><span class="n">product_name</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Product A&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">),</span><span class="w"> </span><span class="c1">-- Related to order_id = 1 from orders table</span>
<span class="w">       </span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Product B&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">),</span><span class="w"> </span><span class="c1">-- Related to order_id = 1 from orders table</span>
<span class="w">       </span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Product C&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span><span class="w"> </span><span class="c1">-- Related to order_id = 2 from orders table</span>
<span class="w">       </span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Product D&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="c1">-- Related to order_id = 3 from orders table</span>

<span class="c1">-- Insert data into audit_logs table with JSONB reference value</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">audit_logs</span><span class="w"> </span><span class="p">(</span><span class="n">log_data</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{</span>
<span class="s1">  &quot;event&quot;: &quot;order_created&quot;,</span>
<span class="s1">  &quot;order_id&quot;: 1,</span>
<span class="s1">  &quot;details&quot;: {</span>
<span class="s1">    &quot;customer_name&quot;: &quot;John Doe&quot;,</span>
<span class="s1">    &quot;total&quot;: 100.00</span>
<span class="s1">  }</span>
<span class="s1">}&#39;</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="s1">&#39;{</span>
<span class="s1">         &quot;event&quot;: &quot;payment_received&quot;,</span>
<span class="s1">         &quot;order_id&quot;: 2,</span>
<span class="s1">         &quot;details&quot;: {</span>
<span class="s1">           &quot;payment_amount&quot;: 200.50,</span>
<span class="s1">           &quot;payment_date&quot;: &quot;2023-08-06&quot;</span>
<span class="s1">         }</span>
<span class="s1">       }&#39;</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="s1">&#39;{</span>
<span class="s1">         &quot;event&quot;: &quot;item_added&quot;,</span>
<span class="s1">         &quot;order_id&quot;: 1,</span>
<span class="s1">         &quot;item&quot;: {</span>
<span class="s1">           &quot;item_id&quot;: 2,</span>
<span class="s1">           &quot;product_name&quot;: &quot;Product B&quot;,</span>
<span class="s1">           &quot;quantity&quot;: 5</span>
<span class="s1">         }</span>
<span class="s1">       }&#39;</span><span class="p">);</span>
</code></pre></div>
<p>The following example demonstrates how to make a subset for keys that does not have FK constraints but a data
relationship exists.</p>
<ul>
<li>The <code>orders</code> table has a virtual reference to the <code>customers</code> table, and the <code>audit_logs</code> table
  has a virtual reference to the <code>orders</code> table.</li>
<li>The <code>payments</code> table has a virtual reference to the <code>orders</code> table.</li>
<li>The <code>order_items</code> table has two keys that reference the <code>orders</code> and <code>products</code> tables.</li>
<li>The <code>audit_logs</code> table has a JSONB column that contains two references to the <code>orders</code> and <code>order_items</code> tables.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">dump</span><span class="p">:</span>
<span class="w">  </span><span class="nt">virtual_references</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;orders&quot;</span>
<span class="w">      </span><span class="nt">references</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customers&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customer_id&quot;</span>
<span class="w">          </span><span class="nt">not_null</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;payments&quot;</span>
<span class="w">      </span><span class="nt">references</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;orders&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;order_id&quot;</span>
<span class="w">          </span><span class="nt">not_null</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;order_items&quot;</span>
<span class="w">      </span><span class="nt">references</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;orders&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;order_id&quot;</span>
<span class="w">          </span><span class="nt">not_null</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;products&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;product_id&quot;</span>
<span class="w">          </span><span class="nt">not_null</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;audit_logs&quot;</span>
<span class="w">      </span><span class="nt">references</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;orders&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(public.audit_logs.log_data</span><span class="nv"> </span><span class="s">-&gt;&gt;</span><span class="nv"> </span><span class="s">&#39;order_id&#39;)::INT&quot;</span>
<span class="w">          </span><span class="nt">not_null</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;order_items&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(public.audit_logs.log_data</span><span class="nv"> </span><span class="s">-&gt;</span><span class="nv"> </span><span class="s">&#39;item&#39;</span><span class="nv"> </span><span class="s">-&gt;&gt;</span><span class="nv"> </span><span class="s">&#39;item_id&#39;)::INT&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(public.audit_logs.log_data</span><span class="nv"> </span><span class="s">-&gt;&gt;</span><span class="nv"> </span><span class="s">&#39;order_id&#39;)::INT&quot;</span>
<span class="w">          </span><span class="nt">not_null</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="nt">transformation</span><span class="p">:</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customers&quot;</span>
<span class="w">      </span><span class="nt">subset_conds</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;public.customers.customer_id</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">(1)&quot;</span>
</code></pre></div>
<p>As a result, the <code>customers</code> table will be dumped with the <code>orders</code> table and its related tables <code>payments</code>,
<code>order_items</code>, and <code>audit_logs</code>. The subset condition will be applied to the <code>customers</code> table, and the data will be
filtered based on the <code>customer_id</code> column.</p>
<h2 id="example-dump-a-subset-with-polymorphic-references">Example: Dump a subset with polymorphic references<a class="headerlink" href="#example-dump-a-subset-with-polymorphic-references" title="Permanent link">&para;</a></h2>
<p>In this example, we will create a subset of the tables with polymorphic references. This example includes the
<code>comments</code> table and its related tables <code>posts</code> and <code>videos</code>.</p>
<div class="highlight"><span class="filename">Create tables with polymorphic references and insert data</span><pre><span></span><code><span class="c1">-- Create the Posts table</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">posts</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w">      </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="w">   </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">content</span><span class="w"> </span><span class="nb">TEXT</span><span class="w">         </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="c1">-- Create the Videos table</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">videos</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w">    </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">url</span><span class="w">   </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="c1">-- Create the Comments table with a polymorphic reference</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">comments</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w">               </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">commentable_id</span><span class="w">   </span><span class="nb">INT</span><span class="w">         </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="c1">-- Will refer to either posts.id or videos.id</span>
<span class="w">    </span><span class="n">commentable_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="c1">-- Will store the type of the associated record</span>
<span class="w">    </span><span class="n">body</span><span class="w">             </span><span class="nb">TEXT</span><span class="w">        </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w">       </span><span class="nb">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span>
<span class="p">);</span>


<span class="c1">-- Insert data into the Posts table</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="k">content</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;First Post&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;This is the content of the first post.&#39;</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="s1">&#39;Second Post&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;This is the content of the second post.&#39;</span><span class="p">);</span>

<span class="c1">-- Insert data into the Videos table</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">videos</span><span class="w"> </span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;First Video&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://example.com/video1&#39;</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="s1">&#39;Second Video&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://example.com/video2&#39;</span><span class="p">);</span>

<span class="c1">-- Insert data into the Comments table, associating some comments with posts and others with videos</span>
<span class="c1">-- For posts:</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">comments</span><span class="w"> </span><span class="p">(</span><span class="n">commentable_id</span><span class="p">,</span><span class="w"> </span><span class="n">commentable_type</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;post&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;This is a comment on the first post.&#39;</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;post&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;This is a comment on the second post.&#39;</span><span class="p">);</span>

<span class="c1">-- For videos:</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">comments</span><span class="w"> </span><span class="p">(</span><span class="n">commentable_id</span><span class="p">,</span><span class="w"> </span><span class="n">commentable_type</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;video&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;This is a comment on the first video.&#39;</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;video&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;This is a comment on the second video.&#39;</span><span class="p">);</span>
</code></pre></div>
<p>The <code>comments</code> table has a polymorphic reference to the <code>posts</code> and <code>videos</code> tables. Depending on the value of the
<code>commentable_type</code> column, the <code>commentable_id</code> column will reference either the <code>posts.id</code> or <code>videos.id</code> column.</p>
<p>The following example demonstrates how to make a subset for tables with polymorphic references.</p>
<div class="highlight"><span class="filename">Subset configuration example</span><pre><span></span><code><span class="nt">dump</span><span class="p">:</span>
<span class="w">  </span><span class="nt">virtual_references</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;comments&quot;</span>
<span class="w">      </span><span class="nt">references</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;posts&quot;</span>
<span class="w">          </span><span class="nt">polymorphic_exprs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;public.comments.commentable_type</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">&#39;post&#39;&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;commentable_id&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;videos&quot;</span>
<span class="w">          </span><span class="nt">polymorphic_exprs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;public.comments.commentable_type</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">&#39;video&#39;&quot;</span>
<span class="w">          </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;commentable_id&quot;</span>

<span class="w">  </span><span class="nt">transformation</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;posts&quot;</span>
<span class="w">      </span><span class="nt">subset_conds</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;public.posts.id</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">(1)&quot;</span>
</code></pre></div>
<p>This example selects only the first post from the <code>posts</code> table and its related comments from the <code>comments</code> table. 
The comments are associated with <code>videos</code> are included without filtering because the subset condition is applied only to
the <code>posts</code> table and related comments. </p>
<p>The resulted records will be:</p>
<div class="highlight"><pre><span></span><code>transformed=# select * from comments;
 id | commentable_id | commentable_type |                 body                  |         created_at         
----+----------------+------------------+---------------------------------------+----------------------------
  1 |              1 | post             | This is a comment on the first post.  | 2024-09-18 05:27:54.217405
  2 |              2 | post             | This is a comment on the second post. | 2024-09-18 05:27:54.217405
  3 |              1 | video            | This is a comment on the first video. | 2024-09-18 05:27:54.229794
(3 rows)
</code></pre></div>







  
  



  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by using our feedback form <iframe 
  src="https://docs.google.com/forms/d/e/1FAIpQLSf6ENCSYImgNa3bNlD1S4ln8AxTVASCt_doTAC2P4Po79ffvA/viewform?embedded=true" 
  width="640" 
  height="447" 
  frameborder="0" 
  marginheight="0" 
  marginwidth="0">Loading…</iframe>
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Greenmask
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/GreenmaskIO" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discord.com/invite/rKBKvDECfd" target="_blank" rel="noopener" title="discord.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/GreenmaskIO/greenmask" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indexes", "announce.dismiss", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.tabs", "navigation.top", "search.highlight", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>